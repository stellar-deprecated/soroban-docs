---
sidebar_position: 21
title: Upgrading Contracts
description: Upgrading the WASM bytecode of a deployed contract.
---

The [upgradeable contract example] demonstrates how to upgrade a WASM contract.

[![Open in Gitpod](https://gitpod.io/button/open-in-gitpod.svg)][oigp]
[oigp]: https://gitpod.io/#https://github.com/stellar/soroban-examples/tree/v0.8.4

[upgradeable contract example]: https://github.com/stellar/soroban-examples/tree/v0.8.4/upgradeable_contract

## Code
The example contains both an "old" and "new" contract, where we upgrade from "old" to "new". The code below is for the "old" contract.

```rust title="upgradeable_contract/old_contract/src/lib.rs"
#![no_std]

use soroban_sdk::{contractimpl, contracttype, Address, BytesN, Env};

#[contracttype]
#[derive(Clone)]
enum DataKey {
    Admin,
}

pub struct UpgradeableContract;

#[contractimpl]
impl UpgradeableContract {
    pub fn init(e: Env, admin: Address) {
        e.storage().set(&DataKey::Admin, &admin);
    }

    pub fn version() -> u32 {
        1
    }

    pub fn upgrade(e: Env, new_wasm_hash: BytesN<32>) {
        let admin: Address = e.storage().get_unchecked(&DataKey::Admin).unwrap();
        admin.require_auth();

        e.update_current_contract_wasm(&new_wasm_hash);
    }
}

```

## How it works

The upgrade is only possible because the contract calls `e.update_current_contract_wasm`, with the wasm hash of the new contract as a parameter. The contract ID does **not** change. Note that the contract required authorization from an admin before upgrading. This is to prevent anyone from upgrading the contract. You can read more about the `update_current_contract_wasm` function in the Soroban Rust SDK [here].

```rust
pub fn upgrade(e: Env, new_wasm_hash: BytesN<32>) {
    let admin: Address = e.storage().get_unchecked(&DataKey::Admin).unwrap();
    admin.require_auth();

    e.update_current_contract_wasm(&new_wasm_hash);
}
```


[here]: https://docs.rs/soroban-sdk/0.8.4/soroban_sdk/struct.Env.html#method.update_current_contract_wasm